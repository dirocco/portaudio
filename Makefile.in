#
# PortAudio Makefile.in
#
# Dominic Mazzoni
#
# Modified By: H. Gregory Silber
#
# WARNING: MODIFY THIS FILE AT YOUR OWN RISK.  THIS FILE SOON TO BE REMOVED
# 	AND REPLACED WITH AUTO GENERATED FILES USING AUTOMAKE
#	IF YOU MUST MODIFY THIS FILE, PLEASE NOTE YOUR CHANGES IN DETAIL
#	DIRECTLY BENEATH THIS MESSAGE
#

PREFIX = @prefix@
CC = @CC@
CFLAGS = @CFLAGS@ -Ipa_common
LIBS = @LIBS@
AR = @AR@
RANLIB = @RANLIB@
INSTALL = @INSTALL@
SHARED_FLAGS = @SHARED_FLAGS@
DLL_LIBS = @DLL_LIBS@

PLAT_DIR = @PLAT_DIR@
CORE_SRC = $(PLAT_DIR)@CORE_SRC@

PALIB = libportaudio.a
PADLL = @PADLL@
PADLLV = $(PADLL)
PAINC = pa_common/portaudio.h

COMMON_OBJS = \
	pa_common/pa_convert.o \
	pa_common/pa_lib.o

GLOBAL_INCLUDES = \
	../../include/portaudio.h 

OBJS = $(COMMON_OBJS) $(PLAT_DIR)pa_core.o

all: libs tests $(GLOBAL_INCLUDES)

tests: 
	$(MAKE) -C pa_tests

libs: ../../lib/$(PALIB) ../../lib/$(PADLLV)

../../lib/$(PALIB): $(OBJS) Makefile $(PAINC)
	$(AR) ruv ../../lib/$(PALIB) $(OBJS)
	$(RANLIB) ../../lib/$(PALIB)

../../lib/$(PADLLV): $(OBJS) Makefile $(PAINC)
	$(CC) $(SHARED_FLAGS) -o ../../lib/$(PADLLV) $(OBJS) $(DLL_LIBS)

clean:
	rm -f $(OBJS) 
	$(MAKE) -C pa_tests clean

distclean: clean
	$(MAKE) -C pa_tests distclean
	rm -f ../../lib/$(PALIB) ../../lib/$(PADLLV) $(GLOBAL_INCLUDES)

$(PLAT_DIR)pa_core.o: $(CORE_SRC) Makefile $(PAINC)
	$(CC) -c $(CFLAGS) $< -o $@

%.o: %.c Makefile $(PAINC)
	$(CC) -c $(CFLAGS) $< -o $@

$(GLOBAL_INCLUDES) : ../../include/% : pa_common/%
	cp -f pa_common/$(@F) ../../include/$(@F)
